<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="https://i.imgur.com/QAjHYHK.png">
    <title>PEPE Kartenbau</title>
    <meta charset="UTF-8">
    <meta name="description" content="Der offizielle Pepe Kartenbaugenerator">
    <style>
      * {
        box-sizing: border-box;
      }
      
      body {
        background: #000000;
        color: #ffffff;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        min-height: 100vh;
      }
      
      h1, h2, h3 {
        color: #4caf50;
        text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
      }
      
      h1 {
        font-size: 2.5rem;
        text-align: center;
        margin-bottom: 10px;
      }
      
      h3 {
        text-align: center;
        margin-bottom: 20px;
      }
      
      h3 a {
        color: #81c784;
        text-decoration: none;
        margin: 0 10px;
      }
      
      h3 a:hover {
        color: #4caf50;
        text-decoration: underline;
      }
      
      p {
        max-width: 800px;
        margin: 0 auto 30px auto;
        line-height: 1.6;
        text-align: center;
      }
      
      a {
        color: #81c784;
        text-decoration: none;
      }
      
      a:hover {
        color: #4caf50;
        text-decoration: underline;
      }
      
      .languages {
        text-align: center;
        margin-bottom: 20px;
      }
      
      .languages img {
        margin: 5px;
        border: 2px solid #333;
        border-radius: 5px;
        transition: border-color 0.3s ease;
      }
      
      .languages img:hover {
        border-color: #4caf50;
      }
      
      .section {
        background: #1a1a1a;
        border: 2px solid #4caf50;
        border-radius: 10px;
        padding: 20px;
        margin: 10px;
        box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
        backdrop-filter: blur(5px);
      }
      
      .section h2 {
        margin-top: 0;
        border-bottom: 2px solid #4caf50;
        padding-bottom: 10px;
      }
      
      input, select, button {
        background: #333;
        color: #fff;
        border: 2px solid #4caf50;
        border-radius: 5px;
        padding: 8px;
        margin: 5px;
        font-size: 14px;
        transition: all 0.3s ease;
      }
      
      input:focus, select:focus, button:focus {
        outline: none;
        border-color: #81c784;
        box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
      }
      
      input:hover, select:hover, button:hover {
        border-color: #81c784;
      }
      
      input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: #4caf50;
      }
      
      input[type="file"] {
        border: none;
        background: transparent;
      }
      
      .greenbtn {
        background: linear-gradient(135deg, #4caf50, #66bb6a);
        color: #fff;
        padding: 15px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: inline-block;
        margin: 10px 5px;
        font-weight: bold;
        text-align: center;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        min-width: 150px;
      }
      
      .greenbtn:hover {
        background: linear-gradient(135deg, #66bb6a, #81c784);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        color: #fff;
        text-decoration: none;
      }
      
      .greenbtn:active {
        transform: translateY(0);
      }
      
      #displaycanvas {
        border: 3px solid #4caf50;
        border-radius: 10px;
        cursor: pointer;
        transition: border-color 0.3s ease;
        background: #222;
      }
      
      #displaycanvas:hover {
        border-color: #81c784;
        box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
      }
      
      #displaycanvasdiv {
        position: relative;
        display: inline-block;
      }
      
      #gridoverlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 256px;
        height: 256px;
        pointer-events: none;
        z-index: 1;
      }
      
      .sizebtn {
        width: 30px;
        height: 30px;
        cursor: pointer;
        margin: 5px;
        background: #333;
        border: 2px solid #4caf50;
        border-radius: 5px;
        padding: 5px;
        transition: all 0.3s ease;
      }
      
      .sizebtn:hover {
        border-color: #81c784;
        background: #444;
      }
      
      #progress {
        background: #333;
        border: 2px solid #4caf50;
        border-radius: 10px;
        margin: 10px 0;
        overflow: hidden;
        position: relative;
      }
      
      #progresstext {
        position: absolute;
        width: 100%;
        text-align: center;
        padding: 10px;
        z-index: 2;
        color: #fff;
        font-weight: bold;
      }
      
      #progressdiv {
        background: linear-gradient(135deg, #4caf50, #66bb6a);
        height: 40px;
        width: 0%;
        transition: width 0.3s ease;
      }
      
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 10px 0;
      }
      
      th, td {
        border: 1px solid #4caf50;
        padding: 10px;
        text-align: left;
      }
      
      th {
        background: #333;
        color: #4caf50;
        font-weight: bold;
      }
      
      tr:nth-child(even) {
        background: #222;
      }
      
      tr:hover {
        background: #333;
      }
      
      details {
        margin: 15px 0;
      }
      
      summary {
        cursor: pointer;
        padding: 10px;
        background: #333;
        border: 2px solid #4caf50;
        border-radius: 5px;
        color: #4caf50;
        font-weight: bold;
        transition: all 0.3s ease;
      }
      
      summary:hover {
        background: #444;
        border-color: #81c784;
      }
      
      details[open] summary {
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
        border-bottom: none;
      }
      
      details main {
        border: 2px solid #4caf50;
        border-top: none;
        border-radius: 0 0 5px 5px;
        padding: 15px;
        background: #1a1a1a;
      }
      
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(5px);
      }
      
      .modalbtn {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        color: #4caf50;
        cursor: pointer;
        background: #333;
        border: 2px solid #4caf50;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }
      
      .modalbtn:hover {
        background: #4caf50;
        color: #fff;
      }
      
      .modalbtn.close {
        right: 20px;
      }
      
      .modalbtn.rotate {
        right: 80px;
      }
      
      .modalbtn.config {
        right: 140px;
      }
      
      #visualcanvas {
        display: block;
        margin: 50px auto;
        border: 3px solid #4caf50;
        border-radius: 10px;
        max-width: 90%;
        max-height: 80%;
        object-fit: contain;
      }
      
      .contactinfo {
        color: #81c784;
        cursor: pointer;
        text-decoration: underline;
      }
      
      .contactinfo:hover {
        color: #4caf50;
      }
      
      small {
        color: #aaa;
      }
      
      #preloads {
        display: none;
      }
      
      /* Responsive Design */
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }
        
        .section {
          float: none !important;
          width: 100%;
          margin: 10px 0;
        }
        
        h1 {
          font-size: 2rem;
        }
        
        .greenbtn {
          display: block;
          width: 100%;
          margin: 10px 0;
        }
      }
      
      /* Layout */
      .section {
        max-width: 400px;
        margin: 10px;
      }
      
      #mapimage {
        min-width: 300px;
      }
      
      /* Custom styling for specific elements */
      input[type="range"] {
        accent-color: #4caf50;
        background: transparent;
        border: none;
      }
      
      input[type="number"] {
        width: 80px;
      }
      
      option {
        background: #333;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="languages"><a href="./de"><img src="./img/flag/de.svg" alt="German" height="50"></a></div>
    <h1>Pepe Kartenbau</h1>
    <div id="blockselection" class="section" style="float: left;">
      <h2 id="blockselectiontitle">Blockauswahl</h2>
      <button id="fauxpresets" type="button" onClick="initCookie()">Presets</button>
    </div>
    <div id="mapimage" class="section" style="float: left">
      <h2>Map Vorschau</h2>
      <input type="file" id="imgupload" style="display: none;" /><br>
      <div id="displaycanvasdiv">
        <span id="gridoverlay" style="display: none; background-image:url('https://i.imgur.com/QAjHYHK.png');"></span>
        <canvas width="128" height="128" id="displaycanvas" onclick="chooseFile()" style="float: right; width: 256px; height: 256px;"></canvas><br>
      </div>
      <small data-tooltip data-title="A source image with this resolution will work the best" id="mapres">128x128</small>
      <small data-tooltip data-title="Image doesn't match map's aspect ratio" id="mapreswarning" style="color:red;display: none">1920x1080</small>
      <img class="sizebtn" src="https://i.imgur.com/QAjHYHK.png" onclick="updatePreviewScale(1)" data-tooltip data-title="Make preview bigger" />
      <img class="sizebtn" src="https://i.imgur.com/QAjHYHK.png" onclick="updatePreviewScale(-1)" data-tooltip data-title="Make preview smaller" />
      <div id="progress"><span id="progresstext"></span><div id="progressdiv"></div></div>
    </div>
    <div id="settings" class="section" style="float: left">
      <h2>Einstellungen</h2>
      <br>
      <b data-tooltip data-title="Modus auswählen">
        Mode:
        <select id="mapmode" onchange="updateMode()">
          <option selected="selected">Schematic (nbt)</option>
          <option>Datafile (map.dat)</option>
        </select>
      </b><br>
      <b data-tooltip data-title="Versionsauswahl">
        Version:
        <select id="version" onchange="updateVersion()">
          <option>1.12</option>
          <option>1.12.1</option>
          <option selected="selected">1.12.2</option>
          <option>1.13.0</option>
          <option>1.13.1</option>
          <option>1.13.2</option>
          <option>1.14.0</option>
          <option>1.14.1</option>
          <option>1.14.2</option>
          <option>1.14.3</option>
          <option>1.14.4</option>
          <option>1.15.0</option>
          <option>1.15.1</option>
          <option>1.15.2</option>
          <option>1.16.0</option>
          <option>1.16.1</option>
          <option>1.16.2</option>
          <option>1.16.3</option>
          <option>1.16.4</option>
          <option>1.16.5</option>
        </select>
      </b><br>
      <b>Map size: </b><input id="mapsizex" type="number" min="1" step="1" value="1" style="width: 2em;" onchange="updateMap()">x<input id="mapsizey" type="number" min="1" step="1" value="1" style="width: 2em;" onchange="updateMap()"><br>
      <b data-tooltip data-title="Crops your image instead of stretching it out" onclick="updateMap()">Crop: <input id="cropimg" type="checkbox"></b><br>
      <b data-tooltip data-title="Overlays a grid that shows 16x16 chunks and 1x1 splits" onclick="updatePreviewScale(0)">Grid: <input id="gridoverlaytoggle" type="checkbox"></b><br>
      <b data-tooltip data-title="Makes the map 3D. Harder to build, but 3 times the colors!">Bauart:<select id="staircasing" onchange="updateMap()">
            <option>Off (2D)</option>
            <option>On (classic)</option>
            <option selected="selected">On (optimized)</option>
          </select></b><br>
      <span id="unobtainiablesection" style="display: none"><b data-tooltip data-title="Enables map.dat colors unobtainiable in schematics" onclick="updateMap()">Unobtainiable colors: <input id="unobtainiable" type="checkbox"></b><br><b data-tooltip data-title="Enables transparency for map.dat" onclick="updateMap()">Transparency: <input id="trans" type="checkbox" checked></b><br></span>
      <b data-tooltip data-title="Gives you better color accuracy" onclick="updateMap()">Better color: <input id="bettercolor" type="checkbox" checked></b><br>
      <b data-tooltip data-title="Adds seemingly random pixels for the illusion of more colors">
        Dithering:
        <select id="dither" onchange="updateMap()">
          <option>None</option>
          <option selected="selected">Floyd–Steinberg</option>
          <option>Bayer (4x4)</option>
          <option>Bayer (2x2)</option>
          <option>Ordered (3x3)</option>
		  <option>MinAvgErr</option>
		  <option>Burkes</option>
		  <option>Sierra-Lite</option>
		  <option>Stucki</option>
		  <option>Atkinson</option>
        </select>
      </b>
      <br>
      <span id="underblockssection">
        <b>
          3D - Blöcke:
          <select id="underblocks">
            <option>No blocks</option>
            <option selected="selected">Important blocks</option>
            <option>All blocks</option>
            <option>All double (optimized)</option>
            <option>All double</option>
          </select>
        </b>
        <br>
        <b data-tooltip data-title="Related to previous option">Block to add: <input type="text" id="underblock" value="minecraft:stone"></b>
        <br>
      </span>
      <details>
        <summary>Image preprocessing</summary>
        <main>
          <b onclick="updateMap()">Enable: <input id="preprocessingenable" type="checkbox"></b><br>
          <table>
            <tr>
              <b>
                <th>Brightness:</th>
                <th><input id="preprocessingbrightnessslider" type="range" min="0" max="200" value="100" onchange="updateProcessingTxt('preprocessingbrightness')"></th>
                <th><input id="preprocessingbrightness" type="number" min="0" step="1" value="100" style="width: 3em;" onchange="updateProcessingSlider('preprocessingbrightness')"></th>
              </b>
            </tr>
            <tr>
              <b>
                <th>Contrast:</th>
                <th><input id="preprocessingcontrastslider" type="range" min="0" max="200" value="100" onchange="updateProcessingTxt('preprocessingcontrast')"></th>
                <th><input id="preprocessingcontrast" type="number" min="0" step="1" value="100" style="width: 3em;" onchange="updateProcessingSlider('preprocessingcontrast')"></th>
              </b>
            </tr>
            <tr>
              <b>
                <th>Saturation:</th>
                <th><input id="preprocessingsaturationslider" type="range" min="0" max="200" value="100" onchange="updateProcessingTxt('preprocessingsaturation')"></th>
                <th><input id="preprocessingsaturation" type="number" min="0" step="1" value="100" style="width: 3em;" onchange="updateProcessingSlider('preprocessingsaturation')"></th>
              </b>
            </tr>
          </table>
        </main>
      </details>
      <br>
      <span id="downloadbtnsection">
        <span class="greenbtn" onclick="getVisuals()" data-tooltip data-title="View the schematic online without downloading">VIEW ONLINE</span><br>
        <span class="greenbtn" onclick="getNbt()" data-tooltip data-title="Download the nbt" style="font-size:32px;height:50px">DOWNLOAD</span><br>
        <span class="greenbtn" onclick="getNbtSplit()" data-tooltip data-title="Download the nbt split into 1x1 chunks">DOWNLOAD AS 1x1 SPLIT</span><br>
      </span>
      <span id="downloadmapdatbtnsection" style="display: none">
        <span class="greenbtn" onclick="getMapDatSplit()" data-tooltip data-title="Download the map.dat split into 1x1 chunks" style="font-size:32px;height:50px">DOWNLOAD</span><br>
      </span>
      <span class="greenbtn" onclick="getPdnPalette()" data-tooltip data-title="Downloads color palette for use in Paint.net">DOWNLOAD PDN PALETTE</span><br>
      <a href="./supporters" data-tooltip data-title="View supporters and donate" style="text-decoration: none;">
        <span class="greenbtn">HELP ME SKIP THE QUEUE</span><br>
      </a>
    </div>
    
    <div id="materials" class="section" style="float: left">
      <h2>Materials</h2>
      <span id="materialsbtnsection">
        <span class="greenbtn" style="width: 162px;height: 17px;" onclick="getMaterials()" data-tooltip data-title="Refresh materials list">REFRESH MATERIALS</span><br>
        <b data-tooltip data-title="For material reuse with locked maps" onclick="getMaterials()">Only show max mats per split: <input id="splitmaterials" type="checkbox"></b><br>
      </span>
      <table id="materialtable">
        <tbody>
          <tr style="display: table-row;">
            <th>Block</th>
            <th>Amount</th>
          </tr>
        </tbody>
      </table>
    </div>
    <div id="visualModal" class="modal">
        <span class="modalbtn close">&times;</span>
        <span class="modalbtn rotate">⭮</span>
        <span class="modalbtn config">🔧</span>
        <canvas width="2177" height="2177" id="visualcanvas"></canvas>
    </div>
    <div id="preloads">
      <img id="blocksimg" src="./img/blocks.png">
      <img src="./img/barrier.png">
      <img id="placeholderimg" src="./img/placeholder.png">
      <img src="./img/null.png">
      <img src="./img/upload.png">
    </div>
  </body>
</html>
